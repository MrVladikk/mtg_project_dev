{% extends "mtg_app/base.html" %}

{% block title %}{{ set.name }} — Сет{% endblock %}

{% block content %}
<div class="card bg-dark-panel mb-4 border-warning border-opacity-25">
  <div class="card-body p-4">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
      <div>
        <span class="badge bg-warning text-dark mb-2 font-monospace">{{ set.code|upper }}</span>
        <h1 class="display-6 fw-bold mb-0">{{ set.name }}</h1>
        <p class="text-muted mb-0 mt-2">
          <i class="bi bi-collection"></i> Карт в сете: {{ cards.count }}
        </p>
      </div>
      
      <form method="get" class="d-flex gap-2">
        <select name="sort" class="form-select form-select-sm" style="width: auto;" onchange="this.form.submit()">
          <option value="">По новизне</option>
          <option value="alphabetical" {% if sort == "alphabetical" %}selected{% endif %}>А-Я</option>
          <option value="price" {% if sort == "price" %}selected{% endif %}>Сначала дешевые</option>
          <option value="price_desc" {% if sort == "price_desc" %}selected{% endif %}>Сначала дорогие</option>
        </select>
      </form>
    </div>
  </div>
</div>

<div class="row row-cols-2 row-cols-md-3 row-cols-xl-5 g-3">
  {% for c in cards %}
    <div class="col">
      <div class="card h-100 border-0 bg-dark-panel shadow-sm">
        <a href="{% url 'mtg_app:card_detail' pk=c.id %}" class="d-block text-decoration-none position-relative">
          <div class="mtg-card-img-wrapper">
            {% if c.image %}
              <img src="{{ c.image.url }}" alt="{{ c.name }}">
            {% elif c.image_url %}
              {% if c.image_url|slice:":1" == "/" or c.image_url|slice:":4" == "http" %}
                <img src="{{ c.image_url }}" alt="{{ c.name }}">
              {% else %}
                <img src="/media/{{ c.image_url }}" alt="{{ c.name }}">
              {% endif %}
            {% elif c.image_filename %}
              <img src="/media/{{ c.image_filename }}" alt="{{ c.name }}">
            {% else %}
              <div class="card-placeholder">
                <span>{{ c.name }}</span>
              </div>
            {% endif %}
          </div>
        </a>
        <div class="card-body p-2 text-center">
          <h6 class="card-title text-truncate small mb-1">
            <a href="{% url 'mtg_app:card_detail' pk=c.id %}" class="text-white text-decoration-none">{{ c.name }}</a>
          </h6>
          {% if c.purchase_price %}
            <span class="badge bg-dark border border-secondary text-warning">{{ c.purchase_price|floatformat:0 }} ₽</span>
          {% endif %}
        </div>
      </div>
    </div>
  {% empty %}
    <div class="col-12 text-center py-5 text-muted">
      Карт в этом сете пока нет.
    </div>
  {% endfor %}
</div>
{% endblock %}