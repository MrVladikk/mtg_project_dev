{% extends "mtg_app/base.html" %}
{% load static %}

{% block title %}{{ card.name }} — Карта{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10 col-xl-9">
    
    <div class="card bg-dark-panel border-warning border-opacity-25 overflow-hidden">
      <div class="card-body p-0">
        <div class="row g-0">
          
          <div class="col-md-5 bg-black d-flex align-items-center justify-content-center p-4 border-end border-secondary">
            {% if card.image_url %}
              <img src="/media/{{ card.image_url }}" alt="{{ card.name }}" class="detail-card-img shadow-lg">
            {% else %}
              <div class="text-muted text-center border border-secondary rounded p-5" style="width: 100%; max-width: 300px; aspect-ratio: 2.5/3.5; display: flex; align-items: center; justify-content: center;">
                <span>Нет изображения</span>
              </div>
            {% endif %}
          </div>

          <div class="col-md-7 p-4 d-flex flex-column">
            
            <div class="border-bottom border-secondary pb-3 mb-3">
              <div class="d-flex justify-content-between align-items-start">
                <h1 class="display-6 fw-bold text-white mb-1">{{ card.name }}</h1>
                <span class="fs-4 fw-bold text-white-50">{{ card.mana_cost|default:"" }}</span>
              </div>
              <div class="d-flex justify-content-between align-items-baseline">
                <span class="fs-5 text-muted">{{ card.type_line|default:"Тип не указан" }}</span>
                {% if card.set %}
                  <a href="{% url 'mtg_app:set_detail' pk=card.set.id %}" class="text-warning text-decoration-none">
                    {{ card.set.name }} <span class="badge bg-warning text-dark">{{ card.set.code|upper }}</span>
                  </a>
                {% endif %}
              </div>
            </div>

            <div class="card bg-black bg-opacity-25 border-secondary mb-3">
              <div class="card-body" style="white-space: pre-line; font-size: 0.95rem;">
                {{ card.oracle_text|default:"Текст карты отсутствует." }}
              </div>
            </div>

            <div class="row g-3 mb-4">
              <div class="col-sm-6">
                <div class="p-3 rounded bg-black bg-opacity-25 border-secondary h-100">
                  <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">Цена покупки</small>
                  <span class="fs-5 fw-medium text-white">
                    {{ card.purchase_price|floatformat:2 }} 
                    {% if card.purchase_price_currency == "RUB" %}₽
                    {% elif card.purchase_price_currency == "EUR" %}€
                    {% else %}$
                    {% endif %}
                  </span>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="p-3 rounded bg-warning bg-opacity-10 border-warning h-100">
                  <small class="text-warning d-block text-uppercase" style="font-size: 0.7rem;">Рыночная цена</small>
                  <span class="fs-5 fw-medium text-warning">
                    {% if card.market_price > 0 %}
                      {{ card.market_price|floatformat:2 }}
                      {% if card.market_price_currency == "EUR" %}€
                      {% else %}$
                      {% endif %}
                    {% else %}
                      (обновляется...)
                    {% endif %}
                  </span>
                </div>
              </div>
            </div>
            <div class="row g-3 mb-4">
              <div class="col-sm-4 col-6"><div class="p-3 rounded bg-black bg-opacity-25 border-secondary h-100">
                  <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">Кол-во</small>
                  <span class="fs-5 fw-medium text-white">{{ card.quantity|default:"0" }} шт.</span>
              </div></div>
              <div class="col-sm-4 col-6"><div class="p-3 rounded bg-black bg-opacity-25 border-secondary h-100">
                  <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">Редкость</small>
                  <span class="fw-medium text-white">{{ card.rarity|title }}</span>
              </div></div>
              <div class="col-sm-4 col-6"><div class="p-3 rounded bg-black bg-opacity-25 border-secondary h-100">
                  <small class="text-muted d-block text-uppercase" style="font-size: 0.7rem;">CMC</small>
                  <span class="fs-5 fw-medium text-white">{{ card.cmc|floatformat:0 }}</span>
              </div></div>
            </div>

            <div class="mt-auto d-flex gap-2">
              <a href="{% url 'mtg_app:card_list' %}" class="btn btn-outline-light">
                <i class="bi bi-arrow-left"></i> Назад
              </a>
              <button class="btn btn-warning flex-grow-1 add-to-deck-btn"
                      data-bs-toggle="modal" 
                      data-bs-target="#addToDeckModal"
                      data-card-id="{{ card.id }}"
                      data-card-name="{{ card.name|escapejs }}">
                <i class="bi bi-plus-lg"></i> Добавить в колоду
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}